# ExACT

ExACT  is the framework for data Extraction and  Analysis for the Cherenkov Telescope. It creates a library called libExACT for access to the files created.

## Pre-Requisites

ROOT Analysis. The installation has only been tested with versions 6 and above.
EventBuilder (optional). The event builder provided from EUSO-SPB2/CT repository. This is used to generate the input files for ExACT. 

## Installation

The installation of ExACT is done with Make. In the main directory /exact/

```bash
make
```
Will run the _Makefile_ and compile all necessary files and generate the library _libExAct.so_. This library will be copied to the ROOT shared libraries for later use.

The executable _ExACT_ will be created and placed in the _./exact/_ directory

The environment variable _LD_LIBRARY_PATH_ must be appended with the path pointing to the dictionaries generated after compilation. Namely, _./exact/dict_

```bash
#.bashrc

LD_LIBRARY_PATH=${LD_LIBRARY_PATH}:[/path/to/]exact/dict
```

## Usage

To run _ExACT_:

```bash
./ExACT -c ./ExACT.cfg -df [path/to/]InputFile -o [path/to/OutputDirectory] -uw [true/false]
```

This provides the compiled code with the needed information for running.

_./ExACT.cfg_ is the configuration file with information about the extraction and analysis to be performed to the data. A copy of the structure is provided in the repository. Active parameters are signaled with an __*__ and if a parameter is not to be used it can be "turned off" by adding a __#__ in front. The file also provides a description of each of the parameters.

_[path/to/]InputFile_ It is the EventBuilder generated file. The raw data is merged with the trigger board information by the EVentBuilder and outputs a file where the traces for each pixel are saved. This file is the one used for extraction and analysis.

_[path/to/OutputDirectory]_ The directory where the output file should be saved. 

_[true/false]_ Whether to use in-flight analysis [false] or not [true]

After extraction ExACT generates an output ROOT file in the same directory as the input file named _InputFile_Extracted.root_. This file is populated with a tree called "t1". Inside this tree each branch corresponds to a different pixel in the camera. In the case of the CT spu it means that the output file contains 512 branches, each with an entry per event. The branches are of data-type ExtractedData, which is defined in the _ExtractedData.h_ and _ExtractedData.cpp_.

In case it is specified in the configuration file, the naming convention of the extracted file can change if FLIGHTMODE is enabled. In that case, the output file follows the naming convention for the download of files through the GCC.

### Reading Output File

A library called libExACT.so contains information on how to access the output ROOT files generated by ExACT. A sample macro is provided in _/exact/macros/ReadExtracted.cpp_. In order to be able to use the classes defined by ExACT, the following macro should be included in the header of the code to be used:

```c++
R__LOAD_LIBRARY(libExACT.so)
```

Alternatively it is possible to load the library interactively in the ROOT CLI using _.L_

```c++
root [0] .L [path/to/exact/libExACT.so]
root [1] [Code]
```

## Contributing

Please use a branch under dev to make any modifications and tests before pushing anything to the main branch.

Please follow the established conventions below:

For CLASSES:

Variables:
- All public variables should start with capital letter I

   e.g. int InumberOfPhotons
- Only camel casing should be used. No underscores for variable names 

   e.g. thisIsCamelCasing this_Is_not
- Please do not make all variables public if there is no need for them
- Access to variable values should exclusively through Get/Set Methods

Methods:
- Constructor method
	- The simplest constructor will initialize all variables to 0;
	- It is possible to overload for passing parameters
- Camel Casing should be observed in naming all methods and they should all start with Uppercase letter
- Only ONE return statement for non-void methods
- Getter and Setter Methods should be named Get\[variableName\] Set\[variableName\]
	e.g. GetNumberOfPhotons()
	- All Gets should return the datatype of the variable. 
	- All Sets should be void
- Memory Address methods will be named Copy\[variableName\]
	e.g. int* CopyNumberOfPhotons()
	- Should always return a pointer to the variable in question.
- Should only be relevant to data format itself. For analysis procedures please 
use the include and source folders NOT in dict/

Classes:
- All user defined classes should start with the letter I\[ClassName\].
- User defined classes should save the header (.h) file in the include directory and the .cpp in the src directory. 
- Any file which name starts with an I can be modified by the user
- DO NOT modify ANY file in the dict folder except for /include/IEvent.h and /src/IEvent.cpp
- Analysis classes should not need instantiation in order for them to be used

We want each stage or analysis part to be run as 

AnalysisTool::ObtainInformation(foo, bar)

To do so, a .h (header) file needs to be created in the include directory
The definitions will go in the .cpp file in the src directory

##EXAMPLE:


###AnalysisTool.h


```c++
		class AnalysisTool{
			public:
				static int ObtainInformation(int foo, int bar);
		};
```

###AnalysisTool.cpp

```c++

		int ObtainInformation(int foo, int bar){
			return foo*bar;
		}
```	

By doing it this way, the dependency of different modules with each other are decreased.

A good example of this is included as IPlotTools.h and IPlotTools.cpp
